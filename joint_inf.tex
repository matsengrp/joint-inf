\documentclass{article}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}
\usepackage{showlabels}
\usepackage{palatino}
\usepackage{hyphenat}
\usepackage{thm-restate}

\graphicspath{ {figures/} }

% http://bytesizebio.net/2013/03/11/adding-supplementary-tables-and-figures-in-latex/
\newcommand{\beginsupplement}{%
        \setcounter{table}{0}
        \renewcommand{\thetable}{S\arabic{table}}%
        \setcounter{figure}{0}
        \renewcommand{\thefigure}{S\arabic{figure}}%
     }

% Commands
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem*{definition}{Definition}

\newcommand{\alphabet}{\mathcal{A}}
\newcommand{\fullAlignment}{\mathbf{Y}}
\newcommand{\alignmentColumn}{\mathbf{y}}
\newcommand{\alignmentColumnRV}{Y}
\newcommand{\siteSplit}{\tilde{s}}
\newcommand{\siteSplitSet}{\mathcal{S}}
\newcommand{\fullAncestralStates}{\mathbf{H}}
\newcommand{\ancestralStateColumn}{\mathbf{h}}
\newcommand{\ancestralStateColumnRV}{H}
\newcommand{\ancestralSplit}{\tilde{h}}
\newcommand{\ancestralSplitSet}{\mathcal{H}}
\newcommand{\ancestralSplitPartition}{\eta}
\newcommand{\fullAncestralSplitPartitions}{\boldsymbol\eta}

\newcommand{\patternToSplit}{\psi}
\newcommand{\ancestralToSplit}{\xi}

\newcommand{\siteSplitRV}{\Psi}
\newcommand{\ancestralSplitRV}{\Xi}

\newcommand{\nCols}{n}
\newcommand{\nSiteRows}{m}
\newcommand{\nAncestralStateRows}{p}
\newcommand{\nSiteSplits}{q}
\newcommand{\nAncestralSplits}{r}

\newcommand{\shannonDivergence}{D}

\DeclareMathOperator*{\argmax}{argmax}

\allowdisplaybreaks

\title{Joint estimation of ancestral states and phylogenetic model parameters is inconsistent}
\author{Shaw, Matsen, Minin}

\begin{document}
\maketitle

\renewcommand{\arraystretch}{1.2} % because otherwise exponents get eaten by \hline

\begin{abstract}
Maximum-likelihood phylogenetics is an approach to estimate the phylogenetic parameters of topology and branch length given observed character data.
Since a phylogeny has unknown intermediate states, computing a maximum likelihood solution requires dealing with these latent variables.
Classically, the method of marginal likelihood is employed: the unknown intermediate states typically come from a small set, and so averaging over their finite space allows for consistent estimation of the parameters of interest.
Recently, a computationally-efficient approach has been proposed to maximize over these unknown states as opposed to averaging over them.
While this method of maximum likelihood has the potential to obtain estimates more efficiently, its properties are not well-understood.
We show that, like other methods of profile likelihood where the number of unknowns grows with observations, this method of jointly estimating phylogenetic parameters along with ancestral states is not consistent in general.
There are a number of cases when generating under a four-taxon tree results in a joint estimation procedure converging on the wrong topology.
If the topology is known a priori, there are similar cases where the branch lengths are consistently overestimated.
While these results do not show joint inference is always inconsistent, they indicate further study into where care can be taken when using this approach.
\end{abstract}

\section*{Introduction}

Classical maximum likelihood (ML) estimation in phylogenetics operates by integrating out possible ancestral states at the internal nodes of the tree.
Recently, \cite{Sagulenko2017-jo} have suggested using an approximation to ML inference in which the likelihood is maximized jointly across model parameters and ancestral sequences.
This is attractive from a computational perspective: such joint ML inference can proceed according to an iterative procedure in which ML ancestral sequences are first inferred and then model parameters are optimized conditional on the ancestral sequences.
This latter conditional optimization is simpler and more computationally efficient than marginalizing over ancestral sequences and then performing optimization.

Existing consistency proofs for maximum likelihood phylogenetics \cite{RoyChoudhury2015-ta} apply only to estimating model parameters when the ancestral sequences have been integrated out of the likelihood.
These proofs do not readily extend to include estimating ancestral states.
Moreover, examples of inconsistency arising from including a large number of additional parameters \cite{Neyman1948-tt} indicate that joint inference of trees and ancestral states may not enjoy good statistical properties.
Although \cite{Sagulenko2017-jo} explicitly warn that their approximation is for the case of branch lengths $\ll 1$ and limit themselves to optimizing branch lengths using this method, their work motivates understanding when exactly this approximation breaks down, and what happens when optimizing branch lengths and tree topology using this approximation.

In this paper, we show that the joint inference of trees and ancestral sequences is not consistent in general.
To do so, we use a binary symmetric model and imagine data being generated on the four-taxon ``Farris zone'' \cite{Siddall1998-hq} tree, and we construct bounds on the joint likelihood to demarcate a sizeable area of long branch lengths in which joint inference is guaranteed to give the wrong tree in the limit of infinite data.
We find similar areas where joint inference consistently overestimates interior branch lengths when the topology is known.

\section*{Phylogenetic maximum likelihood}

Assume the binary symmetric model, namely with a character alphabet $\alphabet=\{0,1\}$ and a uniform stationary distribution \cite{Semple2003-em}.
Let $\nSiteRows$ be the number of tips of the tree, and $\nAncestralStateRows = \nSiteRows-2$ the number of internal nodes.
We observe $\nCols$ samples of character data, i.e., an alignment with $\nCols$ columns, $\fullAlignment=[\alignmentColumn_1,\ldots,\alignmentColumn_\nCols]\in\alphabet^{\nSiteRows\times\nCols}$ distributed as the random variable $\alignmentColumnRV$.
The corresponding unobserved ancestral states are $\fullAncestralStates=[\ancestralStateColumn_1,\ldots,\ancestralStateColumn_\nCols]\in\alphabet^{\nAncestralStateRows\times\nCols}$ and distributed as $\ancestralStateColumnRV$.

We parameterize branches on the unique unrooted four-tip phylogenetic tree in ways known as the ``Farris'' and ``Felsenstein'' trees (Fig.~\ref{fig:farris-fels-top}).
%EM Do you know that "topology" means tree without branch lengths? Therefore I think "tree" is more appropriate in the following sentence and elsewhere.
In the classical configuration of each of these trees, the interior branch length parameters are equal to the bottom two parameters.
We show in the Appendix that, in the case of the Farris tree, fixing both the top two branch parameters to be equal and the bottom two branch parameters to be equal will obtain the same maximum likelihood estimate as in the case of arbitrary branch parameters.

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
\centering
%EM Wouldn't it be better to just parameterize these with x,y,w without primes? Also, it looks super pro if we can use tex fonts in this figure too. I love the mathjax fonts, which I think you can get https://packages.ubuntu.com/trusty/fonts/fonts-mathjax . LMK if you run into trouble. The font I use is "MathJax_Math".
%das: I think I'm either going to go with something other than the primes, like z_1, z_2, z_3, or replace x and y with greek letters or whatever, but it'll be a little bit of a tedious edit.
%EM You mean globally in the whole document? Let's kick around ideas if so.
%das: I think we just need the true generating parameters---x^* and y^*---and the estimands---x', y', w'. I've been bad about using x and y instead of x^* and y^* for function arguments because it's cleaner, and I think there is inconsistency in using the primes and not. How about Greek for unknown (truth) and Latin for estimands? \alpha and \beta for generating parameters and x, y, z for estimands? Would have to change some other notation but shouldn't be too hard I hope.
%EM Wow, this is going to be some work. Sounds like a good plan, but I'd prefer for a system in which it's easy to remember which greek goes with which latin. could we do a, b, g and alpha, beta, gamma or something? Let's keep discussing before making the big change.
\includegraphics[width=.95\textwidth]{farris_blank}
\caption[short]{Farris tree $\tau_1$}
\end{subfigure}
\begin{subfigure}{.45\linewidth}
\centering
\includegraphics[width=.95\textwidth]{felsenstein_blank}
\caption[short]{Felsenstein tree $\tau_2$}
\end{subfigure}
\caption{Two four-taxon trees}
\label{fig:farris-fels-top}
\end{figure}

We parameterize the branches of these trees not with the standard notion of branch length in terms of number of substitutions per site, but with a parameter such that the probability of a substitution on a branch with parameter $\theta$ is $p_\theta = (1-\theta)/2$ while the probability of no substitution is $(1+\theta)/2$ where $0 \le \theta \le 1$.
We follow \cite{Matsen2007-jq} in calling this edge ``fidelity'' as it quantifies the fidelity of transmission of the ancestral state along an edge.
Fidelities have useful algebraic properties, and generating probabilities using the Hadamard transform have an especially simple form (see \eqref{eq:hadamard_probability} in the Appendix).
For a four-taxon tree, define the general branch fidelity parameter $t=\{\theta_1,\theta_2,\theta_3,\theta_4,\theta_5\}$ where fidelities are ordered in the order of the taxa with the internal branch last.
The trees in Fig.~\ref{fig:farris-fels-top} have $\theta_1=\theta_3=x$, $\theta_2=\theta_4=y$, and $\theta_5=w$.

\subsection*{Two paths to maximum likelihood}

The standard phylogenetic likelihood approach on unrooted trees under the usual assumption of independence between sites is as follows.
For a topology $\tau$ and branch fidelities $t$ the likelihood given observed ancestral states $\fullAncestralStates$ is
\begin{equation}
\label{eq:full_likelihood}
L_\nCols(\tau, t; \fullAlignment,\fullAncestralStates) = \prod_{i=1}^{\nCols} \ \Pr(\alignmentColumnRV=\alignmentColumn_i, \ancestralStateColumnRV=\ancestralStateColumn_i \mid \tau, t).
\end{equation}
The probability $\Pr(\alignmentColumnRV=\alignmentColumn_i, \ancestralStateColumnRV=\ancestralStateColumn_i \mid \tau, t)$ is a product of transition probabilities determined by $\fullAlignment$, $\fullAncestralStates$, $\tau$, and $t$ \cite{Felsenstein2004}.

The typical approach to is to maximize the likelihood marginalized across ancestral states
\begin{equation}
\label{eq:marginal_likelihood}
\tilde{L}_\nCols(\tau, t; \fullAlignment) = \sum_{\fullAncestralStates\in\alphabet^{\nAncestralStateRows\times\nCols}} \ L_\nCols(\tau, t; \fullAlignment, \fullAncestralStates)
\end{equation}
to estimate the tree $\tau$ and branch fidelities $t$.

An alternative approach \cite{Sagulenko2017-jo} does away with the marginalization and directly estimates the maximum likelihood parameters of the fully-observed likelihood in \eqref{eq:full_likelihood}.
This is known as a profile likelihood \cite{Murphy2000-ry}, which exists here because $\alphabet$ is a finite set:
\begin{equation}
\label{eq:profile_likelihood}
L_\nCols'(\tau, t; \fullAlignment) = \max_{\fullAncestralStates\in\alphabet^{\nAncestralStateRows\times\nCols}} \ L_\nCols(\tau, t; \fullAlignment, \fullAncestralStates).
\end{equation}
We will use $\hat{\fullAncestralStates}$ to denote an estimate for $\fullAncestralStates$ obtained by maximization \eqref{eq:profile_likelihood}.
One can then estimate a topology and branch fidelities using this profile likelihood:
\begin{equation}
\label{eq:profile_likelihood_topology_bl}
(\hat{\tau}, \hat{t}) = \argmax_{\tau, t} \ L_\nCols'(\tau, t; \fullAlignment).
\end{equation}
In general, the functional form of \eqref{eq:profile_likelihood} is determined by inequalities that depend on the unknown $(\tau,t)$.
For this reason, in practice, the joint ML strategy estimates $\hat{\fullAncestralStates}$ for a fixed $(\tau,t)$, then $(\hat{\tau},\hat{t})$ given $\hat{\fullAncestralStates}$, maximizing each of these conditional objectives until convergence \cite{Sagulenko2017-jo}.


\section*{Inconsistency of joint inference}

We can now state our results on inconsistency of joint inference.
All proofs are deferred to the Appendix.

Assume $\fullAlignment$ is generated from topology $\tau^*$ and branch fidelities $t^*$.
Define $\ell_{\tau^*,t^*}(\tau, t)$ such that
$$
\frac{1}{n}\log L_\nCols'(\tau, t; \fullAlignment) \rightarrow \ell_{\tau^*,t^*}(\tau, t).
$$
We give $\ell$ explicitly in \eqref{eq:site_pattern_profile_likelihood_mean} in the Appendix.

\subsection*{Inconsistency in topology estimation}

\begin{restatable}{theorem}{topoInconsist}
Let $t^*=\{x^*, y^*, x^*, y^*, y^*\}$ and $t=\{x, y, x, y, w\}$.
There exist $L_0(x^*, y^*), L_1(x^*, y^*)$ and $0 < x^*, y^* < 1$ such that
$$
\max_{t} \ \ell_{\tau_1,t^*}(\tau_1, t) \le L_0(x^*, y^*),
$$
$$
\max_{t} \ \ell_{\tau_1,t^*}(\tau_2, t) \ge L_1(x^*, y^*)
$$
with $L_1(x^*, y^*) > L_0(x^*, y^*)$.
\end{restatable}
Fig.~\ref{fig:inconsistency-farris} shows the values of $x^*$ and $y^*$ where $L_1(x^*, y^*) > L_0(x^*, y^*)$.
Intuitively, $\tau_2$ is favored in performing joint maximum likelihood since the likelihood for $\tau_2$ has more ``degrees of freedom''---Table~\ref{tab:likelihoods} shows that $\tau_1$ has only three possible forms for its likelihood while $\tau_2$ has many more.
This results in more possible maxima for $\tau_2$ even if data are generated from $\tau_1$.

\begin{figure}
\centering
% obtained by running
% python joint_inf_plot.py --analytic --topology --delta .001 --plot-name figures/topology-inconsistency.svg
%EM Sorry I didn't notice this before, but the font size everywhere in the plots should be at least doubled before submission. Fine if you want to wait one more cycle. The goal is that it should be the same size as the font in the text.
\includegraphics[width=\textwidth]{topology-inconsistency-inkscape}
\caption{
    Regions of inconsistency.
    Due to the looseness of the upper and lower bounds, the parameters in the top right do not necessarily indicate consistency, though all parameters in the labeled region result in an inconsistency.
}
\label{fig:inconsistency-farris}
\end{figure}

\subsection*{Inconsistency in branch length estimation}

We now consider the problem of branch fidelity estimation on the correct tree using joint ancestral state and branch fidelity estimation.
As described above, we will use the equivalent but different notion of branch fidelities.
We analyze two settings on the Farris topology, corresponding to whether some branch fidelities are fixed at their true values or not.
As above, assume that data is generated from the ``Farris zone'' with two top branches of fidelity $x^*$ and all other branches of fidelity $y^*$.
We show that, for a nontrivial subset of possible values for $x^*$ and $y^*$, the interior branch fidelity parameter $w$ will be consistently overestimated as exactly equal to one instead of its true value of $y^*$.
That is, if we know $x^*$ and $y^*$, then for
$$
\hat{w} = \arg\max_{w} \ \ell_{\tau_1,t^*}(\tau_1, \{x^*,y^*,x^*,y^*,w\}),
$$
we show there are values for $x^*$ and $y^*$ where $\hat{w}\equiv 1$.
In the general case, we do the same but with
$$
(\hat{x}, \hat{y}, \hat{w}) = \arg\max_{x,y,w} \ \ell_{\tau_1,t^*}(\tau_1, \{x,y,x,y,w\}).
$$
These situations are in contrast to the approach using marginal likelihood where necessarily $\hat{w}=y^*$ in the limit of infinite data.

\subsubsection*{Restricted case}

Fix $x=x^*$ and $y=y^*$ to their true, generating values and proceed to estimate the internal branch parameter $w$.
\begin{restatable}{theorem}{restrictedBranchInconsist}
\label{thm:restricted-bl}
Let
$$
\alpha_1 := \alpha_1(x^*, y^*) = \frac{1}{8} \left(1+(x^*)^2+(y^*)^2+4x^*(y^*)^2+(x^*)^2(y^*)^2\right),
$$
$$
\alpha_2 := \alpha_2(x^*, y^*) = \frac{1}{8}\left(1+(x^*)^2+(y^*)^2-4x^*(y^*)^2+(x^*)^2(y^*)^2\right),
$$
$$
\beta := \beta(x^*, y^*) = 1+(x^*)^2+(y^*)^2+(x^*)^2(y^*)^2,
$$
$$
\gamma := \gamma(x^*, y^*) = 4x^*y^*.
$$
The maximum likelihood value $\hat{w} = 1$ if
$$
\beta^2-\gamma^2-2\gamma^2\alpha_1-2\gamma^2\alpha_2+2\gamma\alpha_1\beta-2\gamma\alpha_2\beta \ge 0.
$$
\end{restatable}
The inequality in Theorem~\ref{thm:restricted-bl} is a function of the generating parameters $x^*$ and $y^*$.
This region is shown in Fig.~\ref{fig:bl-inconsistency}.
Intuitively, since we perform maximization over internal states, branch fidelities will have a tendency to be overestimated.
Seeing no change along a branch more likely increases the likelihood by introducing a term of $(1+\theta)$ instead of $(1-\theta)$, and branch fidelities will be positively biased due to this.

\begin{figure}
\centering
% obtained by running
% python joint_inf_plot.py --analytic --restricted-branch-lengths --delta .001 --plot-name figures/branch-length-inconsistency.svg
\includegraphics[width=\textwidth]{branch-length-inconsistency-inkscape}
\caption{Region of inconsistency with $x=x^*$ and $y=y^*$ fixed.}
\label{fig:bl-inconsistency}
\end{figure}

\subsubsection*{General case}

In the general case, $\hat{w}$ is a function of $x^*$, $y^*$, $\hat{x}$, and $\hat{y}$.
Looking to the previous section, $\hat{w}$ is still given by the quadratic formula, only with $\gamma$ and $\beta$ now being functions of $\hat{x}$ and $\hat{y}$ instead of $x^*$ and $y^*$.
Assume we know $\hat{x}$ and $\hat{y}$ as functions of $x^*$ and $y^*$ only.
\begin{restatable}{theorem}{generalBranchInconsist}
\label{thm:general-bl}
For
$$
\beta := \beta(x^*, y^*) = 1+(x^*)^2+(y^*)^2+(x^*)^2(y^*)^2,
$$
$$
\gamma := \gamma(x^*, y^*) = 4x^*y^*,
$$
and bounds
$$
\gamma_L := \gamma_{L}(x^*, y^*) \le \gamma(\hat{x}, \hat{y}),
$$
$$
\gamma_U := \gamma_{U}(x^*, y^*) \ge \gamma(\hat{x}, \hat{y}),
$$
and
$$
\beta_L := \beta_{L}(x^*, y^*) \le \beta(\hat{x}, \hat{y}),
$$
the maximum likelihood value $\hat{w}=1$ when
$$
-\gamma_{U}^2\left(1 + \frac{1}{2}\beta\right) + 2\gamma_{L}\beta_{L}x^*(y^*)^2 + \beta_{L}^2 \ge 0.
$$
\end{restatable}
Similar to Theorem~\ref{thm:restricted-bl}, the inequality in Theorem~\ref{thm:general-bl} is also a function of only $x^*$ and $y^*$, though general forms for $\gamma_L$, $\gamma_U$, and $\beta_L$ are difficult to obtain.
The loosest possible bounds are $\gamma_{L} = 0$, $\beta_{L} = 1$ and $\gamma_{U} = 4$, giving
$$
-16\left(1 + \frac{1}{2}\beta\right) + 1 \ge 0,
$$
which is never true.
The tightest possible bounds are $\gamma_{L} = \gamma_{U} = \gamma$ and $\beta_{L} = \beta$, which is the case in Fig.~\ref{fig:bl-inconsistency}.
For an intermediate bound, define a specified level of error in estimates for $\hat{x}$ and $\hat{y}$ so that
$$
x^*-x_{L} \le \hat{x} \le x^*+x_{U}
$$
and
$$
y^*-y_{L} \le \hat{y} \le y^*+y_{U}.
$$
Then $\gamma_L, \gamma_U$ and $\beta_L$ are defined directly from the bounds on $\hat{x}$ and $\hat{y}$.
As an example, the region to the left side of the curve in Fig.~\ref{fig:bl-loose-inconsistency} shows the case where $x_L=x_U=y_L=y_U=0.1$.
In this case, we will either estimate $\hat{w}$ to be one or estimate either $\hat{x}$ or $\hat{y}$ to be more than $0.1$ away from its true value.

\begin{figure}
\centering
% obtained by running
% python joint_inf_plot.py --analytic --general-branch-lengths --delta .001 --plot-name figures/bl-loose-inconsistency.svg
\includegraphics[width=\textwidth]{bl-loose-inconsistency-inkscape}
\caption{Region of inconsistency with $x^*-0.1 \le \hat{x} \le x^*+0.1$ and $y^*-0.1 \le \hat{y} \le y^*+0.1$.}
\label{fig:bl-loose-inconsistency}
\end{figure}

\subsubsection*{Empirical validation}

The region of inconsistency in Fig.~\ref{fig:bl-loose-inconsistency} is a conservative estimate of where $\hat{w}=1$.
To determine how conservative, we use the method of basin-hopping \cite{Wales1997} to perform joint maximum likelihood estimation using numerical optimization, described in the Appendix.
Since empirical estimates can be unstable, we perform two maximizations---one over $0 \le x,y,w \le 1$ and one over $0 \le x,y \le 1$ with $w=1$---and take the value of $\hat{w}$ with the higher likelihood.
We compute these maxima over a lattice in steps of $10^{-2}$ for $x^*$ and $y^*$ from $10^{-2}$ to $1-10^{-2}$---we do not include zero or one in our lattice to further stabilize the fits, as these cases can result in pathologies.
From this process we obtain the plots in Fig.~\ref{fig:bl-general-inconsistency} and Fig.~\ref{fig:bl-general-marginal}.

The case of marginal inference is as expected, where $\hat{w}$ is equal to $y^*$ in the limit of infinite data regardless of the value of $x^*$.
For joint inference, the estimates for $\hat{w}$ when $x^*$ and $y^*$ are both large look unbiased, with $\hat{w}$ increasing as $y^*$ increases, though the region where $\hat{w}$ is estimated to be one---indicating no change along the interior branch---is similar to that in the restricted case.
Comparing Figs.~\ref{fig:bl-inconsistency} and~\ref{fig:bl-general-inconsistency} shows that the region of inconsistency in the general case is similar to that of the restricted case.
This region encompasses the majority of the parameter space; even given the correct Farris topology and performing our best possible optimization, we have many situations where we will estimate the interior branch parameter to be one.
As a positive control, Fig.~\ref{fig:bl-general-marginal} shows the result of optimizing \eqref{eq:marginal_likelihood} using the same procedure.
Here we obtain the correct $\hat{w}\rightarrow y^*$.

\begin{figure}
\centering
% obtained by running
% python joint_inf_plot.py --empirical --general-branch-lengths --delta .01 --plot-name figures/w-hat-empirical-01.svg --out-pkl-name figures/w-hat-empirical-01.pkl --n-jobs 16
% or
% python joint_inf_plot.py --empirical --general-branch-lengths --plot-name figures/w-hat-empirical-01.svg --in-pkl-name figures/w-hat-empirical-01.pkl
% if fit already
\includegraphics[width=\textwidth]{w-hat-empirical-01}
\caption{
    Estimates for $\hat{w}$ when computing $(\hat{x}, \hat{y}, \hat{w})$ using basin-hopping \cite{Wales1997} optimizing \eqref{eq:profile_likelihood}.
}
\label{fig:bl-general-inconsistency}
\end{figure}

\section*{Discussion}

We have shown that the method of joint inference when estimating phylogenetic parameters is not consistent in general.
Specifically, in the case of four-taxon trees with infinite data, we have obtained nontrivial regions of generating parameters that result in two types of inconsistency: first, inferring the incorrect topology and, second, estimating severely biased branch lengths even given the correct topology.
In all cases, these regions of inconsistency arise when the branches of the generating trees are ``long,'' that is, when branch fidelities are closer to zero than to one.

The method of profile likleihood is well-studied \cite{Murphy2000-ry}.
Many properties regarding the performance of maximum likelihood estimates obtained using this approach are known, and many methods exist to overcome their undesirable properties, e.g., \cite{Geman1982}.
Joint inference of phylogenetic parameters and ancestral states \cite{Sagulenko2017-jo} is a similar approach to profile likelihood.
Elsewhere in statistics literature, the failure of maximum likelihood estimates to obtain consistent estimates in the case of infinite parameters have been shown by the Neyman-Scott paradox \cite{Neyman1948-tt}, though parameters tending to infinity is not a necessary condition for inconsistency \cite{LeCam1990}.
Until recently \cite{RoyChoudhury2015-ta}, results on the properties of standard maximum likelihood estimates of phylogeny as in \eqref{eq:marginal_likelihood} have been difficult to prove, and no results have been obtained for profile likelihood.
We have furthered progress in understanding the limitations of this joint maximum likelihood approach.

In phylogenetics, counterexamples showing methods of phylogenetic inference are inconsistent have been shown using the same four-taxa topologies used here \cite{Felsenstein1978-rr}.
In this case, the converse is shown: when simulating data under the ``Felsenstein zone'' topology $\tau_2$, as the number of observations increases, the ``Farris zone'' topology $\tau_1$ becomes more likely when performing a particular estimation procedure.
Looking at the figure in \cite{Felsenstein1978-rr} we see similarities in curve shape to the region in Fig.~\ref{fig:inconsistency-farris}, though the latter has a smaller region of inconsistency.
Moreover, the inconsistency in \cite{Felsenstein1978-rr} is attributed to long branch attraction, i.e., the fact that there may be multiple long branches where parallel changes are more likely than a single change along a short branch.
This is not the case here; for our case, the inconsistency generally occurs when all branches are long, and has more to do with the choices of the form of the likelihood than from the interplay of long and short branches.
Difficulties in phylogenetic estimation when the ``Farris zone'' generates characters have been found by \cite{Siddall1998-hq}, though \cite{Swofford2001-hr} show that sequence length plays a major role in these issues.



\section*{Acknowledgements}
We thank Richard Neher for helpful discussions.

David Shaw, Vladimir Minin, and Frederick Matsen were supported by NIH grants U19-AI117891 and R01-GM113246; David Shaw and Frederick Matsen were also supported by R01-AI12096.
The research of Frederick Matsen was supported in part by a Faculty Scholar grant from the Howard Hughes Medical Institute and the Simons Foundation.

\bibliographystyle{plain}
\bibliography{joint_inf}

\newpage
\beginsupplement

\input{appendix}

\end{document}
